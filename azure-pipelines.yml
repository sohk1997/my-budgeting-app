
variables:
  GIT_COMMIT: $(Build.SourceVersion)
  GIT_BRANCH: $(Build.SourceBranchName)
  dockerHub: sohk1997.azurecr.io
  imageName: my-budgeting-app

trigger:
- master

steps:
  - task: Docker@2
    displayName: Login registry
    inputs:
      containerRegistry: $(dockerHub)
      command: login
  - task: Docker@2
    displayName: Build image
    inputs:
      repository: $(imageName)
      command: build
      Dockerfile: Dockerfile
      tags: |
        latest
        $(GIT_COMMIT)
  - task: Docker@2
    displayName: Push image
    inputs:
      containerRegistry: $(dockerHub)
      repository: $(imageName)
      command: push
      tags: |
        latest
        $(GIT_COMMIT)
